<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ryan Batten">
<meta name="dcterms.date" content="2022-08-01">

<title>Ryan's Real-World Experience – marginal_vs_conditional</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ryan’s Real-World Experience</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About Me</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/battenr"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rwe_ryan"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">



<section id="marginally-important" class="level2">
<h2 class="anchored" data-anchor-id="marginally-important">Marginally Important</h2>
<p>This post is going to be about marginal compared to conditional effects. First, we need to understand what in the world these terms even mean. To do that, can you guess what we are going to start with? Yup! Probability again.</p>
</section>
<section id="conditional-vs-unconditional-probability" class="level2">
<h2 class="anchored" data-anchor-id="conditional-vs-unconditional-probability">Conditional vs Unconditional Probability</h2>
<p>First things first. Let’s review some basic probability terms. Unconditional probability, denoted as <span class="math inline">\(P(A)\)</span>, is the probability that something will happen. Unconditional probability sounds like a mouthful, so we will use <strong><em>marginal</em></strong> instead. For example, let’s assume in a made-up world that the probability of you getting a visit from the toothfairy is 0.30 on any given night. In mathematical terms:</p>
<p><span class="math display">\[
P(\text{toothfairy visit}) = 0.30
\]</span></p>
<p>Now, the toothfairy randomly visiting you seems a bit bizarre doesn’t it? She’d just drop by any night for no reason at all? Maybe if you wore pink pyjamas to bed she’d visit. This can be worded as “the probability that the toothfairy will visit, given that you are wearing pink pyjamas to bed”. Using mathematical notation again:</p>
<p><span class="math display">\[
P(\text{toothfairy visit} | \text{wearing pink pyjamas})
\]</span></p>
<p>Now, how do we calculate that? Well, the below formula <span class="citation" data-cites="wassertheil2004biostatistics">(<a href="#ref-wassertheil2004biostatistics" role="doc-biblioref">Wassertheil-Smoller and Smoller 2004</a>)</span></p>
<p><span class="math display">\[
P(A|B) = \frac{P(\text{A and B})}{P(B)}
\]</span></p>
<p><span class="math display">\[
P(\text{toothfairy visit | wearing pink pyjamas}) = \frac{P(\text{toothfairy visit and wearing pink pyjamas})}{P(\text{wearing pink pyjamas})}
\]</span></p>
<p>This same logic goes for when we are conducting analyses. It is important to note here that exchangeability and positivity are two requirements for causal inference. There are four adjustment techniques that we’ll touch on briefly: standardization, IP weighting, stratification and matching. First, we need to review the conditional mean</p>
</section>
<section id="conditional-mean" class="level2">
<h2 class="anchored" data-anchor-id="conditional-mean">Conditional Mean</h2>
<p>First, we need to briefly define what exactly a parameter is. A parameter of a model is the term that we derive</p>
<section id="parametric-estimators-of-the-conditional-mean" class="level3">
<h3 class="anchored" data-anchor-id="parametric-estimators-of-the-conditional-mean">Parametric Estimators of the Conditional Mean</h3>
<p>Models that described the conditional mean in terms of a finite number of parameters are referred to as parametric conditional mean models <span class="citation" data-cites="hernanwhatif">(<a href="#ref-hernanwhatif" role="doc-biblioref">Hernan and Robins 2021, 141</a>)</span>.</p>
<p>The point of a model is to estimate the value <span class="math inline">\(E\)</span> of some parameter. The parameter could be the mean or some other measure. Let’s assume that we use the toothfairy visit example again. We want to know the average number of toothfairy visits among people wearing pink pyjamas. In math terms, that would be</p>
<p><span class="math display">\[
E[\text{Toothfairy visits} | \text {Pink pyjamas}]
\]</span></p>
<p>To figure this out, we need a model.</p>
<p><span class="math display">\[
E[\text{Toothfairy visits} | \text {Pink pyjamas}] = \theta_0 + \theta_1*\text{pink pyjamas}
\]</span></p>
<p>The equation above is called a <strong>parametric conditional mean model</strong> <span class="citation" data-cites="hernanwhatif">(<a href="#ref-hernanwhatif" role="doc-biblioref">Hernan and Robins 2021, 141</a>)</span>, because it describes the conditional mean function in terms of a finite number of parameters (note: <span class="math inline">\(\theta_0\)</span> and <span class="math inline">\(\theta_1\)</span> are referred to as parameters).</p>
<p>Once we’ve fitted some data to the model, we can determine the predicted value for each individual. The notation typically used is</p>
<p><span class="math display">\[
\hat{E}[\text{Toothfairy visits} | \text{pink pyjamas = yes}] = \hat{\theta_0} + \hat{\theta_1}*Yes
\]</span></p>
<p>Parametric estimators, those based on a parametric conditional mean model, allow us to estimate quantities that cannot be estimated otherwise However, the inferences are only correct if the restrictions are correct (i.e., the model is correctly specified) <span class="citation" data-cites="hernanwhatif">(<a href="#ref-hernanwhatif" role="doc-biblioref">Hernan and Robins 2021, 152</a>)</span>.</p>
<p>Imagine that in our database, we have no people that wear pink pyjamas but we have people that wear blue and green pyjamas. We would have to use the data that we have to make inferences about those people wearing pink pyjamas. In the above equation, we havd to restrict the shape of the relation, also known as the functional form <span class="citation" data-cites="hernanwhatif">(<a href="#ref-hernanwhatif" role="doc-biblioref">Hernan and Robins 2021, 141</a>)</span>.</p>
</section>
<section id="nonparametric-estimators-of-the-conditional-mean" class="level3">
<h3 class="anchored" data-anchor-id="nonparametric-estimators-of-the-conditional-mean">Nonparametric Estimators of the Conditional Mean</h3>
<p>Nonparametric estimators of the conditional mean are those that produce estimates from the data without any prior restrictions on the conditional mean function <span class="citation" data-cites="hernanwhatif">(<a href="#ref-hernanwhatif" role="doc-biblioref">Hernan and Robins 2021, 143</a>)</span>. To use our example above, the only way to have a nonparametric estimator of the conditional mean would be to have that value measured. Based on our example above, if there were no participants wearing pink pyjamas then there would be no nonparametric estimator for the conditional mean of the toothfairy visiting.</p>
</section>
</section>
<section id="conditional-to-marginal" class="level2">
<h2 class="anchored" data-anchor-id="conditional-to-marginal">Conditional to Marginal</h2>
<p>Now, we can calculate the unconditional expectation using the law of total expectation, however when we are talking about conditional versus marginal in clinical epidemiology, there is an additional layer we need to discuss: effect modification.</p>
<p><span class="math display">\[
E[Y] = \sum_x E[Y|X = x]Pr[X=x]
\]</span></p>
</section>
<section id="effect-modification" class="level2">
<h2 class="anchored" data-anchor-id="effect-modification">Effect Modification</h2>
<p>An effect modifier is when the average causal effect varies across levels of that variable. For example, in figure <a href="#fig-effect">Figure&nbsp;1</a></p>
<p>Effect modification is defined as \</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-effect" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="marginal_vs_conditional_files/figure-html/fig-effect-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 1: Toothfairy, Pyjamas and Age</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The marginal effect measure, would be that that is unconditional (i.e., does not depend on covariates). There are certain methods that can provide a marginal effect measure, while there are others that cannot. Standardization and IP weighting can be used to compute either <strong><em>marginal</em></strong> or <strong><em>conditional</em></strong> effects. Stratification/restriction and matching can only be used to compute <strong><em>conditional</em></strong> effects in certain subsets of the population <span class="citation" data-cites="hernanwhatif">(<a href="#ref-hernanwhatif" role="doc-biblioref">Hernan and Robins 2021, 51</a>)</span>. Let’s break down each of these methods one by one.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-hernanwhatif" class="csl-entry" role="doc-biblioentry">
Hernan, M. A., and J. M. Robins. 2021. <span>“What If - Causal Inference.”</span> Journal Article.
</div>
<div id="ref-wassertheil2004biostatistics" class="csl-entry" role="doc-biblioentry">
Wassertheil-Smoller, Sylvia, and Jordan Smoller. 2004. <em>Biostatistics and Epidemiology: A Primer for Health and Biomedical Professionals</em>. Springer.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>