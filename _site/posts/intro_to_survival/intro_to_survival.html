<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ryan Batten">
<meta name="dcterms.date" content="2022-10-24">

<title>Ryan’s Real-World Evidence - Introduction to Survival Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ryan’s Real-World Evidence</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/battenr"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rwe_ryan"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Introduction to Survival Analysis</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Survival Analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Ryan Batten </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 24, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="survival-analysis-and-halloween-candy" class="level2">
<h2 class="anchored" data-anchor-id="survival-analysis-and-halloween-candy">Survival Analysis and Halloween Candy?</h2>
<p>What could time-to-event analysis and Halloween candy possible have in common? Well with Halloween fast approaching, we will get to go trick or treating which means more candy! However, it seems that sometimes our candy disappears quicker after Halloween than it probably should. Why is that you may ask? Well, sometimes parents get their hands on candy and gobble it up before you can get to eat every last piece! How will we deal with this?</p>
<p>Putting on our statistics had, one solution is to try and found out what the median time is to all of our candy being eaten and then try to make sure it’s all gone by then (or if not, then our favorite candy at least!). Luck for us, there is a a database that keeps track of kids candy and whether they got to eat all their candy.</p>
</section>
<section id="research-question" class="level2">
<h2 class="anchored" data-anchor-id="research-question">Research Question</h2>
<p>The first part to any research project is to first define our research question. In this situation we want to know: “What is the risk of all of my candy going missing</p>
<p>With Christmas approaching soon, we all want to know: what are the odds of Santa vising me before my friends? Luckily, there is a database that keeps track of all of this! So, how are we going to answer our question with Christmas fast approaching? Well, one method would be to use a linear regression, or perhaps a generalized linear model, however there is a unique component to time-to-event data: censoring.</p>
</section>
<section id="causal-question" class="level2">
<h2 class="anchored" data-anchor-id="causal-question">Causal Question</h2>
<p>The first part to any research project is to define the research question. Our research question is: “What is the median time to getting to eat all of my candy?”. Now that we know our research question, we need to look to our handy-dandy database that has data on this.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>n.obs <span class="ot">=</span> <span class="dv">244</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>maxtime <span class="ot">=</span> <span class="dv">12</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20221106</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># credit to post here from Tomas Bene</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span>n.obs, <span class="at">size =</span> n.obs, <span class="at">replace =</span> <span class="cn">FALSE</span>),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">runif</span>(<span class="at">n=</span> n.obs, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">22</span>),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> n.obs, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.81</span>), <span class="co"># 1 = female</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">costume =</span> <span class="fu">sample</span>( <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"avocado"</span>,<span class="st">"bumblebee"</span>, <span class="st">"pumpkin"</span>, <span class="st">"lion"</span>),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">size =</span> n.obs, </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">replace =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.40</span>, <span class="fl">0.30</span>, <span class="fl">0.20</span>, <span class="fl">0.10</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">candy_amount =</span> <span class="fu">runif</span>(<span class="at">n =</span> n.obs, <span class="at">min =</span> <span class="dv">20</span>, <span class="at">max =</span> <span class="dv">100</span>), <span class="co"># number of pieces of candy</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">candy_type =</span> <span class="fu">sample</span> (<span class="at">x =</span> </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">c</span>(<span class="st">"skittles"</span>, <span class="st">"popeye sticks"</span>, <span class="st">"candy corn"</span>, <span class="st">"lemon heads"</span>, <span class="st">"M&amp;Ms"</span>),  </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">size =</span> n.obs, </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">replace =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.30</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.20</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  ), <span class="co"># what is the most common type of candy you have </span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxtime =</span> <span class="dv">12</span> <span class="co"># 12 months until next Halloween</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>surv_data <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">censort =</span> maxtime<span class="sc">*</span><span class="fu">runif</span>(<span class="at">n =</span> n.obs, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>),</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">hr_age =</span> <span class="fl">0.5</span>,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">hr_sex =</span> <span class="fl">0.6</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">hr_costume =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      costume <span class="sc">==</span> <span class="st">"avocado"</span> <span class="sc">~</span> <span class="fl">2.3</span>, </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      costume <span class="sc">==</span> <span class="st">"bumblebee"</span> <span class="sc">~</span> <span class="fl">1.4</span>,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>      costume <span class="sc">==</span> <span class="st">"pumpkin"</span> <span class="sc">~</span> <span class="fl">0.36</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>      costume <span class="sc">==</span> <span class="st">"lion"</span> <span class="sc">~</span> <span class="fl">0.56</span> </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">hr_candy_amount =</span> <span class="fl">0.001</span>, </span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">hr_candy_type =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>      candy_type <span class="sc">==</span> <span class="st">"skittles"</span> <span class="sc">~</span> <span class="fl">0.8</span>,</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>      candy_type <span class="sc">==</span> <span class="st">"popeye sticks"</span> <span class="sc">~</span> <span class="fl">0.4</span>, </span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>      candy_type <span class="sc">==</span> <span class="st">"candy corn"</span> <span class="sc">~</span> <span class="fl">0.2</span>, </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>      candy_type <span class="sc">==</span> <span class="st">"lemon heads"</span> <span class="sc">~</span> <span class="fl">0.5</span>, </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>      candy_type <span class="sc">==</span> <span class="st">"M&amp;Ms"</span> <span class="sc">~</span> <span class="fl">0.9</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">candy_num =</span> </span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        candy_type <span class="sc">==</span> <span class="st">"skittles"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        candy_type <span class="sc">==</span> <span class="st">"popeye sticks"</span> <span class="sc">~</span> <span class="dv">2</span>, </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        candy_type <span class="sc">==</span> <span class="st">"candy corn"</span> <span class="sc">~</span> <span class="dv">3</span>, </span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        candy_type <span class="sc">==</span> <span class="st">"lemon heads"</span> <span class="sc">~</span> <span class="dv">4</span>, </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        candy_type <span class="sc">==</span> <span class="st">"M&amp;Ms"</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">costume_num =</span> </span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        costume <span class="sc">==</span> <span class="st">"avocado"</span> <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        costume <span class="sc">==</span> <span class="st">"bumblebee"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        costume <span class="sc">==</span> <span class="st">"pumpkin"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        costume <span class="sc">==</span> <span class="st">"lion"</span> <span class="sc">~</span> <span class="dv">4</span> </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_age =</span> <span class="fu">log</span>(hr_age),</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_sex =</span> <span class="fu">log</span>(hr_sex),</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_costume =</span> <span class="fu">log</span>(hr_costume),</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_candy_amount =</span> <span class="fu">log</span>(hr_candy_amount),</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_candy_type =</span> <span class="fu">log</span>(hr_candy_type)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># h = exp(beta_age*age + beta_sex*sex + beta_candy_amount*candy_amount + beta_candy_type),</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">h =</span> <span class="fu">exp</span>(beta_candy_type<span class="sc">*</span>candy_num <span class="sc">+</span> beta_sex<span class="sc">*</span>sex <span class="sc">+</span> beta_costume<span class="sc">*</span>costume_num),</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">dt =</span> <span class="sc">-</span><span class="fu">log</span>(<span class="fu">runif</span>(n.obs))<span class="sc">/</span>h, <span class="co"># taken from above link but Tomas referred to Bender article. </span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>             <span class="co"># Bender formula for times T ~ Exponential(baseline_hazard)</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>      dt <span class="sc">&lt;=</span> censort <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>      dt <span class="sc">&gt;</span> censort <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>             <span class="co"># If you don't want to simulate </span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>             </span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> <span class="fu">pmin</span>(dt, censort) <span class="co"># taking minimum of calculated dt above or the censored time</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>One thing we notice when we look at the data is that we aren’t sure if some kids get to eat all of their candy or not. This could be due to different reasons, such as them getting sick of their candy, only having their least favorite kind left, parent’s not letting them eat the rest or….the worst of all… parents eating the rest of their candy! What should we do with this partial data?</p>
<p>One thing we could do is to delete this partial data as missing data, however we’d lose lots of valuable information! Even though we don’t know when their candy was finished, we know the last time they had <em>some</em> candy left. This is info that we can definitely use, but how should we approach it? This is where censoring comes into play.</p>
</section>
<section id="censoring" class="level2">
<h2 class="anchored" data-anchor-id="censoring">Censoring</h2>
<p>So what exactly is censoring? Well, it’s a fancy way to deal with having partial information. For example, imagine that we know that our best friend had candy and the last day that she had some candy left but that was the last day we knew she had candy available. This type of observation is called <em>right censoring</em> <span class="citation" data-cites="clark2003survivalI">(<a href="#ref-clark2003survivalI" role="doc-biblioref">Clark et al. 2003</a>)</span>. Censoring could also occur where we know the event, for example when all her candy was gone, but not when she got the candy to begin with. This is called <em>left censoring</em> <span class="citation" data-cites="clark2003survivalI">(<a href="#ref-clark2003survivalI" role="doc-biblioref">Clark et al. 2003</a>)</span>. There is also a third type of censoring called <em>interval censoring</em> <span class="citation" data-cites="clark2003survivalI">(<a href="#ref-clark2003survivalI" role="doc-biblioref">Clark et al. 2003</a>)</span> <em>,</em> where the people being observed can come in and out of being observed.</p>
</section>
<section id="visualize-visualize-visualize" class="level2">
<h2 class="anchored" data-anchor-id="visualize-visualize-visualize">Visualize, Visualize, Visualize</h2>
<p>One of the best things to do when first inspecting any data is to plot it. Let’s do that with our data</p>
<div class="cell">

</div>
</section>
<section id="kaplan-meier-plot" class="level2">
<h2 class="anchored" data-anchor-id="kaplan-meier-plot">Kaplan-Meier Plot</h2>
</section>
<section id="statistical-methods" class="level2">
<h2 class="anchored" data-anchor-id="statistical-methods">Statistical Methods</h2>
<section id="cox-proportional-hazards" class="level3">
<h3 class="anchored" data-anchor-id="cox-proportional-hazards">Cox Proportional Hazards</h3>
</section>
<section id="kaplan-meier" class="level3">
<h3 class="anchored" data-anchor-id="kaplan-meier">Kaplan Meier</h3>
</section>
</section>
<section id="functions" class="level2">
<h2 class="anchored" data-anchor-id="functions">Functions</h2>
<section id="probability-density-function" class="level3">
<h3 class="anchored" data-anchor-id="probability-density-function">Probability Density Function</h3>
<p><span class="math display">\[
f(t) = \lim_{\triangle \to 0}\frac{1}{\triangle}P(t \leq T \leq t + \triangle)
\]</span></p>
</section>
<section id="survival-function" class="level3">
<h3 class="anchored" data-anchor-id="survival-function">Survival Function</h3>
<p>The survival function is given by <span class="math inline">\(S(t) = P(T&gt;t)\)</span>, which is the probability that the event occurs after time t</p>
<p><span class="math display">\[
S(t) = 1 - P(T\leq t) = 1 - F(t) = 1-\int_{0}^{1}f(s)ds
\]</span></p>
<p>where F(t) is the cumulative distribution function, also referred to as the cumulative incidence function somtimes</p>
</section>
<section id="hazard-function" class="level3">
<h3 class="anchored" data-anchor-id="hazard-function">Hazard Function</h3>
<p>The hazard function is related to the survival function as</p>
<p><span class="math display">\[
\lambda(t) = \lim_{\triangle \to 0}\frac{1}{\triangle}P(t \leq T \leq t + \triangle |T \geq t)
\]</span></p>
<p>It is important to note that <span class="math inline">\(P(t \leq T \leq t + \triangle | T \geq t)\)</span> is the probability the event has not occurred by time <span class="math inline">\(t\)</span> but then does occur in the next time interval <span class="math inline">\(\triangle\)</span>. Another way of thinking of this is the conditional probability of experiencing the event within the next <span class="math inline">\(\triangle\)</span> time units at time <span class="math inline">\(t\)</span> given that the event has not occurred yet.</p>
<p><span class="math display">\[
\lambda(t) = \frac{f(t)}{S(t)} = -\frac{d}{dt} log S(t)
\]</span></p>
</section>
<section id="cumulative-hazard-function" class="level3">
<h3 class="anchored" data-anchor-id="cumulative-hazard-function">Cumulative Hazard Function</h3>
<p>Similarly, the cumulative hazard function could be defined as</p>
<p><span class="math display">\[
\Lambda(t) = -log S(t)
\]</span></p>
</section>
</section>
<section id="bonus" class="level2">
<h2 class="anchored" data-anchor-id="bonus">Bonus!</h2>
<section id="distribution-for-tte-data" class="level3">
<h3 class="anchored" data-anchor-id="distribution-for-tte-data">Distribution for TTE Data</h3>
<p>Each of the four function can be used to characterize the distribution of T. For a data analysis, you can first choose some parametric distribution and then structure any of the four functions (<span class="math inline">\(f(t)\)</span>, <span class="math inline">\(S(t)\)</span>, <span class="math inline">\(\lambda(t), \Lambda(t)\)</span> )</p>
<section id="exponential-distribution" class="level4">
<h4 class="anchored" data-anchor-id="exponential-distribution">Exponential Distribution</h4>
<p><span class="math display">\[
h_i(t) = \lambda \text{ exp}(X_i^T\beta)
\]</span></p>
<p><span class="math display">\[
H_i(t) = \lambda t \text{ exp}(X_i^T\beta)
\]</span></p>
<p><span class="math display">\[
S_i(t) = \text {exp}(-\lambda t \text { exp}(X_i^T \beta))
\]</span></p>
<p><span class="math display">\[
S_i^{-1}(u) = \frac{\text{- log}(u)}{\lambda \text{ exp}(X_i^T \beta)}
\]</span></p>
</section>
<section id="weibull-distribution" class="level4">
<h4 class="anchored" data-anchor-id="weibull-distribution">Weibull Distribution</h4>
<p><span class="math display">\[
h_i(t) = \gamma \lambda (t^{\gamma-1}) \text{ exp}(X_i^T\beta)
\]</span></p>
<p><span class="math display">\[
H_i(t) = \lambda (t^{\gamma}) \text{ exp}(X_i^T\beta)
\]</span></p>
<p><span class="math display">\[
S_i(t) = \text {exp}(-\lambda (t^{\gamma}) \text { exp}(X_i^T \beta))
\]</span></p>
<p><span class="math display">\[
S_i^{-1}(u) = (\frac{\text{- log}(u)}{\lambda \text{ exp}(X_i^T \beta)})^{\frac{1}{\gamma}}
\]</span></p>
</section>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"></h3>
<section id="gompertz-distribution" class="level4">
<h4 class="anchored" data-anchor-id="gompertz-distribution">Gompertz Distribution</h4>
<p><span class="math display">\[
h_i(t) = \lambda \text{ exp}(\gamma t) \text{ exp}(X_i^T\beta)
\]</span></p>
<p><span class="math display">\[
H_i(t) = \frac {\lambda(\text {exp } (\gamma t) -1}{\gamma} \text{ exp}(X_i^T\beta)
\]</span></p>
<p><span class="math display">\[
S_i(t) = \text {exp}( \frac{(-\lambda(exp(\gamma t) - 1)}{\gamma} \text { exp}(X_i^T \beta))
\]</span></p>
<p><span class="math display">\[
S_i^{-1}(u) = \frac{1}{\gamma}\text{log}[(\frac{-\gamma \text{log}(u)}{\lambda \text{exp}(X_i^T\beta)}) + 1]
\]</span></p>
</section>
</section>
</section>
<section id="kaplan-meier-estimator" class="level2">
<h2 class="anchored" data-anchor-id="kaplan-meier-estimator">Kaplan-Meier Estimator</h2>
<p>The Kaplan-Meier estimator, sometimes referred to as the <em>life table method</em> can be used to estimate the survival function nonparametrically (aka without assuming anything about the underlying distribution).</p>
<p>The conditional probability of survival past time <span class="math inline">\(t_{(k)}\)</span>, given the event had not occurred by time <span class="math inline">\(t_{(k)}\)</span> as:</p>
<p><span class="math display">\[
\hat{P}(T&gt;t_{(k)}|T\geq t_{(k)} = \frac{s_k}{n_k} = 1 - \frac{d_k}{n_k}
\]</span></p>
<p>If we multiply these conditional probabilities across all risk sets, we can find the Kaplan-Meier estimator of <span class="math inline">\(S(t)\)</span> :</p>
<p><span class="math display">\[
\hat{S}_{KM}(t) = \prod_{k:t_{(k)} \leq t} \frac{s_k}{n_k} = \prod_{k:t_{(k)} \leq t} 1- \frac{d_k}{n_k}
\]</span></p>
</section>
<section id="section-1" class="level2">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-clark2003survivalI" class="csl-entry" role="doc-biblioentry">
Clark, Taane G, Michael J Bradburn, Sharon B Love, and Douglas G Altman. 2003. <span>“Survival Analysis Part i: Basic Concepts and First Analyses.”</span> <em>British Journal of Cancer</em> 89 (2): 232–38.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>