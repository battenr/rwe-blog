<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ryan Batten">
<meta name="dcterms.date" content="2023-07-01">

<title>Blog Posts - Who are we talking about?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Blog Posts</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../freelance.html" rel="" target="">
 <span class="menu-text">Consulting</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/rwe-ryan" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rwe_ryan" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/battenr" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Who are we talking about?</h1>
            <p class="subtitle lead">The Role of Causal Estimands</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Estimands</div>
                <div class="quarto-category">ATE</div>
                <div class="quarto-category">ATT</div>
                <div class="quarto-category">ATU</div>
                <div class="quarto-category">ATO</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Ryan Batten </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 1, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#who-does-this-apply-too" id="toc-who-does-this-apply-too" class="nav-link active" data-scroll-target="#who-does-this-apply-too">Who does this apply too?</a></li>
  <li><a href="#magical-water-gun-for-height" id="toc-magical-water-gun-for-height" class="nav-link" data-scroll-target="#magical-water-gun-for-height">Magical Water Gun for Height?</a></li>
  <li><a href="#types-of-estimands" id="toc-types-of-estimands" class="nav-link" data-scroll-target="#types-of-estimands">Types of Estimands</a>
  <ul>
  <li><a href="#ate" id="toc-ate" class="nav-link" data-scroll-target="#ate">ATE</a></li>
  <li><a href="#att" id="toc-att" class="nav-link" data-scroll-target="#att">ATT</a></li>
  <li><a href="#atu" id="toc-atu" class="nav-link" data-scroll-target="#atu">ATU</a></li>
  <li><a href="#ato" id="toc-ato" class="nav-link" data-scroll-target="#ato">ATO</a></li>
  </ul></li>
  <li><a href="#choose-your-adjustment-technique-wisely" id="toc-choose-your-adjustment-technique-wisely" class="nav-link" data-scroll-target="#choose-your-adjustment-technique-wisely">Choose Your Adjustment Technique Wisely!</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next Steps</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="who-does-this-apply-too" class="level2">
<h2 class="anchored" data-anchor-id="who-does-this-apply-too">Who does this apply too?</h2>
<p>A key part of any research question is to figure out who our <em>target population</em> is. These are the people we want to study. For example, is it 85 year olds who play american football? Is it children between 5-11 years of age using the swings at the park? Determining this allows us to figure out who to sample but also who our results will be applicable to. The best way show this is through an example, so without further ado let’s get started!</p>
</section>
<section id="magical-water-gun-for-height" class="level2">
<h2 class="anchored" data-anchor-id="magical-water-gun-for-height">Magical Water Gun for Height?</h2>
<p>Imagine that monsters came out of your closet, Monsters Inc.&nbsp;style, and claimed that they have a magical water gun that makes you grow taller. We want to know if they are telling the truth or if they are fibbing, but first we need to figure out who exactly they are claiming this will work on.<br>
<br>
In clinical epidemiology, we determine this by following the <strong>PICO</strong> acronym: <strong>P</strong>opulation, <strong>I</strong>ntervention, <strong>C</strong>omparator and <strong>O</strong>utcome(s). For this situation, our research question would look something like this: “Does being sprayed with a water gun increased your height, compared to not being sprayed?”.<br>
<br>
Now this is a good start but who exactly are we referring too? Who do we want to know if it works for? Everyone in the world? Just children? Short adults? The causal estimand helps us with this part.</p>
<div id="fig-sample" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="kids_monsters.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Monsters</figcaption>
</figure>
</div>
<p>These monsters that have shown up all of a sudden say they’ve sprayed some of themselves with the water gun and it’s worked! Some kids who want to grow have eagerly signed up and been sprayed as well. The effect has varied individual by individual so we need to know: who’s this actually working for, if at all? Why? Well both monsters and kids are pretty short, their friends want to know if it will work on them! (cue the monstars from Space Jam). <a href="#fig-sample">Figure&nbsp;1</a> shows what our sample looks like. As you can see, there’s a mixture of monsters and kids in each group which will make it harder to determine if the magical water gun is actually working, or if monsters just grow taller than kids.<br>
<br>
The figure is just illustrative. Let’s look at the actual characteristics from the individuals we will be studying outlined in <a href="#tbl-characteristics">Table&nbsp;1</a>.</p>
<div id="tbl-characteristics" class="anchored">
<table class="table">
<caption>Table&nbsp;1: Characteristics</caption>
<colgroup>
<col style="width: 41%">
<col style="width: 31%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"><p>Sprayed by Water Gun</p>
<p>(n = 458)</p></th>
<th style="text-align: center;"><p>Not Sprayed</p>
<p>(n = 129)</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Number of eyes, mean (SD)</td>
<td style="text-align: center;">2.59 (1.31)</td>
<td style="text-align: center;">2.38 (1.29)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Age, mean (SD)</td>
<td style="text-align: center;">27.75 (40.4)</td>
<td style="text-align: center;">23.27 (37.83)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Monsters, n (%)</td>
<td style="text-align: center;">110 (24.0%)</td>
<td style="text-align: center;">25 (19.4%)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Height (in feet), mean (SD)</td>
<td style="text-align: center;">1.71 (0.65)</td>
<td style="text-align: center;">1.60 (0.66)</td>
</tr>
</tbody>
</table>
</div>
<p>There were 458 individuals sprayed by the water gun, while 129 were not sprayed. There’s differences in age and percentage of monsters. Looking at just height, you could think that this magical water gun works! However….and a <strong><em>big</em></strong> however…does it? Or is it just that it works better on monsters? Or that monsters are taller?<br>
<br>
Now, confounding aside, what do we want to know? Who to spray with this gun! It’s not quite as simple and straightforward as that. Let’s briefly go over the four estimands we’ll be talking about in this case.</p>
</section>
<section id="types-of-estimands" class="level2">
<h2 class="anchored" data-anchor-id="types-of-estimands">Types of Estimands</h2>
<p>We’ll focus on four causal estimands, in no particular order:</p>
<ul>
<li><p>Average treatment effect in the population (ATE)</p></li>
<li><p>Average treatment effect in the treated (ATT)</p></li>
<li><p>Average treatment effect in the untreated (ATU)</p></li>
<li><p>Average treatment effect in the overlap (ATO)</p></li>
</ul>
<p>One important thing to note here is that all of these estimands would be the same in a randomized trial because the characteristics will be the same (at least in theory). Therefore, the ATT, ATU, ATE and ATO will be the same. However, not so in observational data.</p>
<p>Like many, almost all, areas of science, there are several assumptions that must be met. For causal inference, these assumptions are exchangeability, positivity, consistency, no versions of treatment and no interference. I suggest checking out the appendix in <span class="citation" data-cites="greifer2021choosing">Greifer and Stuart (<a href="#ref-greifer2021choosing" role="doc-biblioref">2021</a>)</span> since these can vary by the estimand selected.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Potential Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>An important component here is the concept of potential outcomes. These can be written as <span class="math inline">\(Y_0\)</span> and <span class="math inline">\(Y_i\)</span> <span class="citation" data-cites="greifer2021choosing">(<a href="#ref-greifer2021choosing" role="doc-biblioref">Greifer and Stuart 2021</a>)</span>. For a binary treatment, like in our case, we can think of it as each person has two <em>potential</em> outcomes <strong>prior</strong> to them getting the treatment or not. After they receive the treatment, only one of them is revealed <span class="citation" data-cites="greifer2021choosing">(<a href="#ref-greifer2021choosing" role="doc-biblioref">Greifer and Stuart 2021</a>)</span>.<br>
<br>
Now, the individual causal effect is <span class="math inline">\(Y_1\)</span> - <span class="math inline">\(Y_0\)</span> for each person. In a perfect world, we’d know this however the world isn’t perfect. Instead, we take an average (if we assume certain things, described in <span class="citation" data-cites="greifer2021choosing">Greifer and Stuart (<a href="#ref-greifer2021choosing" role="doc-biblioref">2021</a>)</span> ). In math terms, we show this as <span class="math inline">\(E[Y_{1} - Y_{0}]\)</span>.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Propensity Score
</div>
</div>
<div class="callout-body-container callout-body">
<p>We will be using propensity scores to estimate each of these estimands. A brief overview of the propensity score is that it’s the conditional probability of treatment. More simply put, it’s the probability of being sprayed by the water gun based on your number of eyes and if you’re a monster or not.</p>
</div>
</div>
<section id="ate" class="level3">
<h3 class="anchored" data-anchor-id="ate">ATE</h3>
<p>Ask yourself: would it be feasible to spray all eligible people in this study with the magical water gun? If we assume yes, then we could look at the ATE <span class="citation" data-cites="desai2019">(<a href="#ref-desai2019" role="doc-biblioref">Desai and Franklin 2019</a>)</span>.</p>
<p>The ATE is the effect of the treatment for the entire study population <span class="citation" data-cites="greifer2021choosing">(<a href="#ref-greifer2021choosing" role="doc-biblioref">Greifer and Stuart 2021</a>)</span>. Another way of thinking of this is to ask how would height change if <em>everyone</em> was sprayed with the water gun versus if <em>no one</em> was sprayed with the water gun. If we write it in math terms, it’s:</p>
<p><span class="math display">\[E[Y_{1}-Y_{0}]\]</span></p>
<p>Now, how do we estimate this? One way is to use inverse probability weights. To calculate these, we need the propensity score (PS). Once we know the PS, we can calculate these weights as <span class="math inline">\(1/{PS}\)</span> for the treated group and <span class="math inline">\(1/(1-{PS})\)</span> for the control group. Then we can plug these weights into the outcome model and away we go!</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, fit a model for the treatment (in this case our water gun)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>ps.mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(sprayed <span class="sc">~</span> eyes <span class="sc">+</span> group, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> df)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Use </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>df.ps <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ps =</span> <span class="fu">predict</span>(ps.mod, <span class="at">type =</span> <span class="st">"response"</span>), </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">weights_ate =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Note: for simplicity using unstabilized weights </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>      sprayed <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span><span class="sc">/</span>ps, </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>      sprayed <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>outcome.mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(height <span class="sc">~</span> <span class="fu">as.character</span>(sprayed),</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> weights_ate, </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> df.ps)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>sandwich_se <span class="ot">&lt;-</span> <span class="fu">diag</span>(sandwich<span class="sc">::</span><span class="fu">vcovHC</span>(outcome.mod, <span class="at">type =</span> <span class="st">"HC"</span>))<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>outcome <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(outcome.mod) <span class="sc">|&gt;</span> </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    term <span class="sc">==</span> <span class="st">"as.character(sprayed)1"</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>   <span class="at">upper.ci =</span> estimate <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>sandwich_se[<span class="dv">2</span>],</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>   <span class="at">lower.ci =</span> estimate <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>sandwich_se[<span class="dv">2</span>], </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"Average Height Difference: "</span>, <span class="fu">round</span>(outcome<span class="sc">$</span>estimate, <span class="dv">3</span>), <span class="st">" 95% CI ("</span>, <span class="fu">round</span>(outcome<span class="sc">$</span>lower.ci,<span class="dv">3</span>), <span class="st">" to "</span>, <span class="fu">round</span>(outcome<span class="sc">$</span>upper.ci, <span class="dv">3</span>), <span class="st">")"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Average Height Difference: 0.022 95% CI (-0.109 to 0.154)"</code></pre>
</div>
</div>
<p>Ta da! Now we know that being sprayed with a water gun doesn’t affect the height in our ATE population. But what about if not everyone is eligible for the treatment?</p>
</section>
<section id="att" class="level3">
<h3 class="anchored" data-anchor-id="att">ATT</h3>
<p>Now we ask, would the treatment only be given to patients with certain characteristics? If yes, then the ATT might be of interest <span class="citation" data-cites="desai2019">(<a href="#ref-desai2019" role="doc-biblioref">Desai and Franklin 2019</a>)</span>. This is also useful when considering the harmful effects of a treatment <span class="citation" data-cites="greifer2021choosing">(<a href="#ref-greifer2021choosing" role="doc-biblioref">Greifer and Stuart 2021</a>)</span>. For our example, we want to know what the effects of the water gun are in those receiving it. If it doesn’t work in the people getting sprayed, then why are we spraying them? Would we be better off not soaking them? In mathematical notation:</p>
<p><span class="math display">\[E[Y_{1}-Y_{0}|T = 1]\]</span></p>
<p>In term of weights, all of the patients in the treated group get a value of <span class="math inline">\(1\)</span> while those in the control get a value of <span class="math inline">\(PS / (1-PS)\)</span>. These are known as standardized mortality ratio weights.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df.ps <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ps =</span> <span class="fu">predict</span>(ps.mod, <span class="at">type =</span> <span class="st">"response"</span>), </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">weights_att =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Note: for simplicity using unstabilized weights </span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      sprayed <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      sprayed <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> ps<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>outcome.mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(height <span class="sc">~</span> <span class="fu">as.character</span>(sprayed),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> weights_att, </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> df.ps)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>sandwich_se <span class="ot">&lt;-</span> <span class="fu">diag</span>(sandwich<span class="sc">::</span><span class="fu">vcovHC</span>(outcome.mod, <span class="at">type =</span> <span class="st">"HC"</span>))<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>outcome <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(outcome.mod) <span class="sc">|&gt;</span> </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    term <span class="sc">==</span> <span class="st">"as.character(sprayed)1"</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>   <span class="at">upper.ci =</span> estimate <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>sandwich_se[<span class="dv">2</span>],</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>   <span class="at">lower.ci =</span> estimate <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>sandwich_se[<span class="dv">2</span>], </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"Average Height Difference: "</span>, <span class="fu">round</span>(outcome<span class="sc">$</span>estimate, <span class="dv">3</span>), <span class="st">" 95% CI ("</span>, <span class="fu">round</span>(outcome<span class="sc">$</span>lower.ci,<span class="dv">3</span>), <span class="st">" to "</span>, <span class="fu">round</span>(outcome<span class="sc">$</span>upper.ci, <span class="dv">3</span>), <span class="st">")"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Average Height Difference: 0.022 95% CI (-0.11 to 0.154)"</code></pre>
</div>
</div>
<p>Our results are similar but not the same as those for the ATE! In this case they are close but often that isn’t true.</p>
</section>
<section id="atu" class="level3">
<h3 class="anchored" data-anchor-id="atu">ATU</h3>
<p>The ATU is similar to the ATT except opposite (okay admittedly that sentence doesn’t make a lot of sense). The ATU is asking how would the height be different if the monsters and kids who didn’t get sprayed, got sprayed? In mathematical notation:</p>
<p><span class="math display">\[E[Y_{1}-Y_{0}|T = 0]\]</span></p>
<p>How do we calculate the ATU? You guessed it! The opposite of the ATT…well kind of. It’s <span class="math inline">\(1\)</span> for those in the control group and <span class="math inline">\((1-PS)/PS\)</span> for the treated group.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.ps <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ps =</span> <span class="fu">predict</span>(ps.mod, <span class="at">type =</span> <span class="st">"response"</span>), </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">weights_atu =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Note: for simplicity using unstabilized weights </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>      sprayed <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> (<span class="dv">1</span><span class="sc">-</span>ps)<span class="sc">/</span>ps, </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      sprayed <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>outcome.mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(height <span class="sc">~</span> <span class="fu">as.character</span>(sprayed),</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> weights_atu, </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> df.ps)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>sandwich_se <span class="ot">&lt;-</span> <span class="fu">diag</span>(sandwich<span class="sc">::</span><span class="fu">vcovHC</span>(outcome.mod, <span class="at">type =</span> <span class="st">"HC"</span>))<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>outcome <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(outcome.mod) <span class="sc">|&gt;</span> </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    term <span class="sc">==</span> <span class="st">"as.character(sprayed)1"</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>   <span class="at">upper.ci =</span> estimate <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>sandwich_se[<span class="dv">2</span>],</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>   <span class="at">lower.ci =</span> estimate <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>sandwich_se[<span class="dv">2</span>], </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"Average Height Difference: "</span>, <span class="fu">round</span>(outcome<span class="sc">$</span>estimate, <span class="dv">3</span>), <span class="st">" 95% CI ("</span>, <span class="fu">round</span>(outcome<span class="sc">$</span>lower.ci,<span class="dv">3</span>), <span class="st">" to "</span>, <span class="fu">round</span>(outcome<span class="sc">$</span>upper.ci, <span class="dv">3</span>), <span class="st">")"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Average Height Difference: 0.023 95% CI (-0.104 to 0.15)"</code></pre>
</div>
</div>
</section>
<section id="ato" class="level3">
<h3 class="anchored" data-anchor-id="ato">ATO</h3>
<p>ATO is the average effect of the treatment in the overlap. Those patients who it’s unclear if the benefits would outweigh the costs <span class="citation" data-cites="greifer2021choosing">(<a href="#ref-greifer2021choosing" role="doc-biblioref">Greifer and Stuart 2021</a>)</span>. These patients are very similar to each other but less similar for patients who the treatment decisions are more “clear cut” so to say <span class="citation" data-cites="greifer2021choosing">(<a href="#ref-greifer2021choosing" role="doc-biblioref">Greifer and Stuart 2021</a>)</span>. In mathematical notation:</p>
<p><span class="math display">\[E[Y_{1}-Y_{0}]\]</span></p>
<p>Now something you might notice here is that the equation is the same as above for the ATE. Why is that? Well it’s because we are still reweighing both the treated and control groups but it’s a different target population. Instead of it being “everyone” like above, it’s the people who are in the uncertain group. We weigh them as <span class="math inline">\(PS\)</span> for the sprayed group and <span class="math inline">\(1-PS\)</span> for the not sprayed group.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.ps <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ps =</span> <span class="fu">predict</span>(ps.mod, <span class="at">type =</span> <span class="st">"response"</span>), </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">weights_ato =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Note: for simplicity using unstabilized weights </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      sprayed <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> (<span class="dv">1</span><span class="sc">-</span>ps), </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>      sprayed <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> ps</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>outcome.mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(height <span class="sc">~</span> <span class="fu">as.character</span>(sprayed),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> weights_ato, </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> df.ps)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>sandwich_se <span class="ot">&lt;-</span> <span class="fu">diag</span>(sandwich<span class="sc">::</span><span class="fu">vcovHC</span>(outcome.mod, <span class="at">type =</span> <span class="st">"HC"</span>))<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>outcome <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(outcome.mod) <span class="sc">|&gt;</span> </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    term <span class="sc">==</span> <span class="st">"as.character(sprayed)1"</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>   <span class="at">upper.ci =</span> estimate <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>sandwich_se[<span class="dv">2</span>],</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>   <span class="at">lower.ci =</span> estimate <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>sandwich_se[<span class="dv">2</span>], </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"Average Height Difference: "</span>, <span class="fu">round</span>(outcome<span class="sc">$</span>estimate, <span class="dv">3</span>), <span class="st">" 95% CI ("</span>, <span class="fu">round</span>(outcome<span class="sc">$</span>lower.ci,<span class="dv">3</span>), <span class="st">" to "</span>, <span class="fu">round</span>(outcome<span class="sc">$</span>upper.ci, <span class="dv">3</span>), <span class="st">")"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Average Height Difference: 0.022 95% CI (-0.106 to 0.151)"</code></pre>
</div>
</div>
</section>
</section>
<section id="choose-your-adjustment-technique-wisely" class="level2">
<h2 class="anchored" data-anchor-id="choose-your-adjustment-technique-wisely">Choose Your Adjustment Technique Wisely!</h2>
<p>Picking the estimand of interest isn’t just important for the <em>target population</em> but also for the adjustment technique selected. Certain adjustment techniques can only target certain estimands <span class="citation" data-cites="greifer2021choosing">(<a href="#ref-greifer2021choosing" role="doc-biblioref">Greifer and Stuart 2021</a>)</span>. This becomes even more important when you are comparing methods.</p>
<p>For example, IPW and PSM do not target the same estimand <span class="citation" data-cites="greifer2021choosing">(<a href="#ref-greifer2021choosing" role="doc-biblioref">Greifer and Stuart 2021</a>)</span>. There is a great flowchart for the steps involved by <span class="citation" data-cites="desai2019">Desai and Franklin (<a href="#ref-desai2019" role="doc-biblioref">2019</a>)</span> when trying to decide on the technique. Additionally, <span class="citation" data-cites="greifer2021choosing">Greifer and Stuart (<a href="#ref-greifer2021choosing" role="doc-biblioref">2021</a>)</span> have a good table for selecting the technique based on the causal estimand.</p>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next Steps</h2>
<p>What’s next? Well know you can go out into the world and answer all your burning questions like “Does this magical water gun actually work?” and followup with “Who exactly does it work on?”</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-desai2019" class="csl-entry" role="listitem">
Desai, Rishi J, and Jessica M Franklin. 2019. <span>“Alternative Approaches for Confounding Adjustment in Observational Studies Using Weighting Based on the Propensity Score: A Primer for Practitioners.”</span> <em>Bmj</em> 367.
</div>
<div id="ref-greifer2021choosing" class="csl-entry" role="listitem">
Greifer, Noah, and Elizabeth A Stuart. 2021. <span>“Choosing the Estimand When Matching or Weighting in Observational Studies.”</span> <em>arXiv Preprint arXiv:2106.10577</em>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>