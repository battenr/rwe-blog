---
title: "Hot Diggity DAG" 
subtitle: "An introduction to DAGs"
author: "Ryan Batten"
date: "2023-07-15"
categories: [DAGs, Causal Diagrams]
# image : "standards.png"
bibliography: dags.bib
draft: true
format: 
  html:
    toc: true
    toc-title: Contents
    toc-location: right
    toc-depth: 4
    code-fold: true
---

## Don't Analyze Graphs?

Yes..well no...well kinda. DAG in this case, stands for Directed Acyclic Graph. It's a graph that is directed and acyclic...alright that's not much of an explanation. Let's try again: a causal DAG shows how your variables are related. To quote Miguel Hernan, since I couldn't have said it better myself, "Draw your assumptions before your conclusions".

::: callout-note
## This post is an introduction

One small note before we continue. This post is meant to be an introduction to DAGs, however there will be lots of posts in the future using DAGs (i.e., for identifying selection bias, confounding, for missingness, etc).
:::

## Why should I?

A perfectly valid question at this point is "Why should I? I don't need these". The phrase a picture is worth a thousand words applies here too. As a side note,

## Does Coffee Increase My Alertness?

I'm an avid coffee drinker. I love hot coffee, iced coffee, cold brew, nitro cold brew...you name it, I'm in (unless it's bad coffee). Something I often wonder is if drinking a lot of coffee actually improves my alertness or not. That is, does coffee cause my alertness? Let's start here. We'll assume that coffee does cause alertness and draw a line between the two.

```{r, message=FALSE}

library(tidyverse)
library(ggdag)
theme_set(theme_dag())

coffee_dag <- ggdag::dagify(
  alert ~ coffee, 
  exposure = "coffee",
  outcome = "alert",
  labels = c(
    coffee = "Coffee",
    alert = "Alertness"
  )
)

ggdag::ggdag(coffee_dag, text = FALSE, use_labels = "label")

```

This looks great but there's one glaring problem....there are many, many, MANY variables that affect both of these variables. How much you've slept, stress and hunger just to name a few. Not to mention that each of those variables are related.\
\
So our DAG needs some editing, but first we need to go over some assumptions or "house rules" per say.

## Assumptions of DAGs

Let's start with the acronym. They are called DAGs because they have a direction and cannot have a variable that causes itself, either directly or through another variable [@hernanwhatif, pp. 72].

Another key component is the causal Markov assumption, which put simply is that a variable is independent of any variable that it isn't a cause for (for more details about this check out @hernanwhatif, pp. 72). This assumption means that in a causal DAG, the common causes of any pair of variables in the graph must also be in the graph.\
\
For example,

### D-Separation

The rules are like so [@hernanwhatif, pp. 78]:

1.  If no variables are being conditioned on, a path is blocked if and only if two arrowheads on the path collide at some variable on the path.

2.  Any path that contains a non-collider that has been conditioned on is blocked.

3.  A collider that has been conditioned on does not block a path.

4.  A collider that has a descendant that has been conditioned on does not block a path.

::: callout-note
## Causal Graph Theory

There is some complex math, nonparametric structural equation models to be exact, behind these rules that I won't go into here. If you are interested, I recommend checking out the work of Judea Pearl, or some sections of @hernanwhatif.
:::

We will summarize d-separation like so: a path is blocked if and only if, it contains a non-collider that has been conditioned on, or it contains a collider that has not been conditioned on and has no descendants that have been conditioned on [@hernanwhatif, pp. 78].

Two variables are d-separated if all paths between them are blocked (otherwise we say they're d-connected) [@hernanwhatif, pp. 78].

## Some Terms 

-   Moderator

-   Mediator

-   Ancestors

## Water Flowing in a Pipe?

To borrow a concept from Judea Pearl, think of water flowing in a pipe. For association, it can flow both ways but for causality it cannot. For the rules outlined for d-separation about think about it like water. If there is a collider, then water cannot flow there. If the collider is conditioned on, its like we moved the dam and water can now flow.

## Effect Modification

Let's look at the below DAG.

```{r}

coffee_dag <- ggdag::dagify(
  alert ~ coffee + deep_breaths, 
  exposure = "coffee",
  outcome = "alert",
  labels = c(
    coffee = "Coffee",
    alert = "Alertness",
    deep_breaths = "Deep Breathing"
  )
)

ggdag::ggdag(coffee_dag, 
             layout = "circle", 
             text = FALSE, use_labels = "label")
```

We see that deep breathing affects alertness but not drinking coffee. Now, if we didn't include deep breathing it would still be a valid causal diagram because deep breathing isn't a common cause of coffee and alertness. We'd only need to include if it was part of our causal question (e.g., what is the average causal effect of coffee on alterness *within levels of deep breathing?)*.

Now, another point is that including it in our causal diagram doesn't distinguish which of the following three ways that alertness could modify the effect of coffee on alertness:

1.  The causal effect of coffee on alertness is in the same direction in both stratum deep breathing = yes and deep breathing = no

2.  The direction fo the causal effect of coffee on alertness in stratum deep breathing = yes is opposite of that in stratum deep breathing = no (sometimes referred to as Simpson's paradox).

3.  Coffee has a causal effect on alertness in one stratum of deep breathing but no causal effect in the other stratum.

Now, our DAG fails to distinguish which of these is the type of effect modification. Additionally, many effect modifiers do not have a causal effect on the outcome. Instead, they are surrogates for variable that have a causal effect on the outcome.

For example, let's look at deep breathing again.

```{r}

coffee_dag <- ggdag::dagify(
  alert ~ coffee + stress, 
  deep_breaths ~ stress,
  exposure = "coffee",
  outcome = "alert",
  labels = c(
    coffee = "Coffee",
    alert = "Alertness",
    deep_breaths = "Deep Breathing",
    stress = "Stress"
  )
)

ggdag::ggdag(coffee_dag, 
             layout = "circle", 
             text = FALSE, use_labels = "label")
```

In this DAG, we see deep breathing is actually a surrogate for a variable that has a causal effect. Deep breathing is a *surrogate effect modifier* whereas stress is a *causal effect modifier*. Both of these are often indistinguishable in practice, so the concept of effect modification encompasses both [@hernanwhatif, pp. 81].

## Uses of DAGs

Great, so we now know how to draw a DAG but is this even useful? Absolutely! It can be used for variable selection, etc, etc.

## Why do we need a DAG?

Before we get started into what it actually is and the rules, it's always a good idea to review the why.

You should

(can ref/talk about riley2022 12 days of christmas statisitician article)

## 

## 
